# 花火溯琦（花火BBS重构）  
一个使用spring boot+spring mvc+mybatis+JSP的BBS  

## 具体功能~~和花火BBS一致~~比原来牛逼
* 用户登录
* 留言/修改留言
* 修改个人信息
* 根据用户ID查询发言
* 浏览留言界面以10个为一页进行分页
* 基于Filter的权限管理和用户组功能<sup>new
* 基于AOP的日志系统<sup>new

## 安全特性  
* 基于mybatis从而实现了防止SQL注入
* 使用org.apache.commons.lang3的StringEscapeUtils类的相关方法杜绝了HTML注入
* 使用MD5（并加盐）加密用户密码存储在数据库中
* 通过对登录用户的身份和操作进行鉴别（详情见service的RightsCheck类）对用户行为进行限制


*以下为权限管理和用户组的设计文档*  

----
## RBAC总体需求

1. 有一个超级管理员,用户名默认admin  ,可以做所有事情 
   
2. 有权限的概念, 例如 ：
   * 编辑用户信息,
   * 浏览用户,
   * 浏览消息,
   * 编辑自己的消息,
   * 编辑所在用户组其他人留言,
   * 编辑其他用户组的人的留言等
  
3. 有角色的概念,可以给用户授予 角色, 也可以编辑这个角色拥有的权限 , 当用户是某个角色的时候可以拥有这个角色的权限

4. 有用户组的概念,一个用户组可以有多个用户,用户 可以对 自己的留言,用户组内的留言,用户组外的留言进行不同的操作,例如 对于用户组外的留言能看,对于用户组内的消息能编辑等,这个是靠前两个概念管理的
   
5. 其他属于RBAC的概念可以自由在自己能控制住的范围内自由发挥
   
6. 邮件中需要有自己设计的 数据库表的  ER图 截图


### 权限等级
|等级| 编辑/浏览自己信息 | 编辑他人信息 | 浏览组内他人用户信息 | 浏览其他组的他人用户信息 | 浏览消息 | 编辑/删除自己消息 | 编辑/删除所在用户组其他人留言 | 编辑/删除其他用户组的人的留言 |
|---|---|---|---|---|---|---|---|---|
|普通用户|√| | | |√|√| | | | 
|组长（普通管理员）|√| |√|  √|√|√|√| | 
|超级管理员|√|√|√|√|√|√|√|√|

* C级人员权限：
    1. 编辑/浏览自己信息
    2. 浏览消息
    3. 编辑/删除自己消息
   
* B级人员权限：
    1. 编辑/浏览自己信息
    2. 浏览消息
    3. 编辑/删除自己消息
    4. 浏览组内他人用户信息
    5. 编辑/删除所在用户组其他人留言

* A级人员权限：
    1. 编辑/浏览自己信息
    2. 浏览消息
    3. 编辑/删除自己消息
    4. 浏览组内他人用户信息
    5. 编辑/删除所在用户组其他人留言
    6. 编辑他人信息
    7. 浏览其他组的他人用户信息
    8. 编辑/删除其他用户组的人的留言

### 用户组设计

**基本思路：**  
**每个用户都必须在一个用户组内，一个用户只能在一个用户组内**

1. 普通用户组  
   包含若干普通用户和组长

2. 超级用户组  
   仅包含超级管理员一人，  
   如有多个超级管理员则设置多个超级用户组

**特别说明：组长概念**  
**组长是相对于用户组而言的，组长在一个组内是组长，由于一个用户只能在一个组内，所以在别的组该组长就是普通用户的权限**

### 引入权限后的评论追加属性

* 组属性，由创建评论的用户所在组决定。（可通过用户外键查询，此处不在数据库中实现）
    * NG 普通组
    * SG 超级用户组


### 引入权限后的用户追加属性

* 组属性（外键），决定用户所在组
* 身份，决定用户是A/B/C三类人员（A类人员不可能在普通组）
  * AU：超级管理员
  * BU：组长（普通管理员）
  * CU：普通用户

### 引入权限后需要追加的表
用户组表
* 组ID
* 组名
* 组种类
